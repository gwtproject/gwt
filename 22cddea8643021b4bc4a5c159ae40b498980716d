{
  "comments": [
    {
      "key": {
        "uuid": "9310f93f_ddb79f0c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 13
      },
      "lineNbr": 15,
      "author": {
        "id": 5030
      },
      "writtenOn": "2014-08-18T11:24:01Z",
      "side": 1,
      "message": "I believe you could extract Jetty from gwt-dev into another JAR rather than re-downloading Jetty.\n\nThat doesn\u0027t change the fact that it\u0027s an ugly hack.",
      "range": {
        "startLine": 14,
        "startChar": 9,
        "endLine": 15,
        "endChar": 39
      },
      "revId": "22cddea8643021b4bc4a5c159ae40b498980716d",
      "serverId": "84fdd5b9-d3fc-3149-9ae9-e619898c4c46",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9310f93f_3df57ba0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 13
      },
      "lineNbr": 15,
      "author": {
        "id": 7170
      },
      "writtenOn": "2014-08-18T12:17:57Z",
      "side": 1,
      "message": "Thanks for your comments. I\u0027am reading them in this and dependent change and try to understand the workarounds that your describing to address our problem. But i have strong impression, that you are missing one use case, that we cannot implement with current situation with all workarounds provided. At least i cannot see how.\n\nGerrit Code Review project has traditionally delivered very sane development environment experience for its contributors. So the separation between Gerrit\u0027s JettyServer process and Codeserver process for SDM doesn\u0027t convince here. This is because it is a big disadvantage to spawn multiple processes; instead it must be combined in one, that i solved here [1]. Really, it worked in one process with DevMode and it works in one with SDM as well, as prototyped in [1]. \n\nBut how can i spawn one process with conflicting Jetty versions in classpath to satisfy Gerrit\u0027\u0027s 9.2 Jetty dependency for one and Codeserver Jetty 8.2 for another? \n\nCan you now see why we don\u0027t have any workarounds for Jetty classpath conflict at our avail and why the only option we have is having Jetty-9 compatible version of code server, that is solved in this change?\n\n [1] https://gerrit-review.googlesource.com/59354",
      "parentUuid": "9310f93f_ddb79f0c",
      "range": {
        "startLine": 14,
        "startChar": 9,
        "endLine": 15,
        "endChar": 39
      },
      "revId": "22cddea8643021b4bc4a5c159ae40b498980716d",
      "serverId": "84fdd5b9-d3fc-3149-9ae9-e619898c4c46",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d3043104_5f7b8f3e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 13
      },
      "lineNbr": 15,
      "author": {
        "id": 5030
      },
      "writtenOn": "2014-08-18T16:36:00Z",
      "side": 1,
      "message": "Technically, you could just use separate classloaders; but that wouldn\u0027t be that easy to setup (how to easily get the 2 classpaths in your launcher app or Eclipse launcher configuration? invoke buck from the launcher app maybe?)\n\nGoktug floated the idea on the forum to provide SDM as a servlet (or set of servlets) that you could deploy within your app. The prerequisite is that we split gwt-dev though (or provide a trimmed-down JAR, similar to gwt-servlet.jar nowadays), so it won\u0027t happen soon. In the mean time, I think we should rebase our dependencies (I just stumbled on a bug in the tracker where we said we should rebase Eclipse JDT, because people have classpath conflicts when they use JDT on the server-side and can\u0027t easily/don\u0027t setup separate client-side and server-side classpaths).\n\nAs you\u0027re in need of a quick fix or workaround, I\u0027d suggest that you try rebasing Jetty in your build (maybe update Bucklets\u0027 maven_jar to accept a \u0027rename\u0027 in addition to \u0027exclude\u0027 and call JarJar or similar on the downloaded JAR), and possibly contribute rebased JARs (Google might have them so we could also ask them to upload them in the SVN repo) and patch to GWT to use the rebased Jetty (that would also simplify dev/codeserver build/setup). That way, you\u0027d have 2 Jetty versions in the classpath at the same time without them conflicting (except maybe for the javax.servlet version :-/ We could maybe update to Jetty 9.2 *and* do the renaming it at the same time?)",
      "parentUuid": "9310f93f_3df57ba0",
      "range": {
        "startLine": 14,
        "startChar": 9,
        "endLine": 15,
        "endChar": 39
      },
      "revId": "22cddea8643021b4bc4a5c159ae40b498980716d",
      "serverId": "84fdd5b9-d3fc-3149-9ae9-e619898c4c46",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9310f93f_c0069286",
        "filename": "/COMMIT_MSG",
        "patchSetId": 13
      },
      "lineNbr": 15,
      "author": {
        "id": 7170
      },
      "writtenOn": "2014-08-19T09:08:44Z",
      "side": 1,
      "message": "| As you\u0027re in need of a quick fix or workaround\n\nIndeed, i do. \n\n| As you\u0027re in need of a quick fix or workaround, I\u0027d suggest that you try rebasing Jetty in your build [...] That way, you\u0027d have 2 Jetty versions in the classpath at the same time without them conflicting [...].\n\nI think the rebasing of outdated Jetty version and burrowing it inside codeserver to prevent classpath conflicts is wrong thing to do. Sure, we all do really weird stuff and ugly workarounds, but this is what the $DAY_JOB is for. Let\u0027s try to keep such quirks away from free software.\n\nI like Brian\u0027s suggestion to drop dependency on Jetty from code server altogether  and replace it with something much more lightweight. That would solve all our problems: we would keep stripping outdated Jetty version from get-dev.jar and SDM would just work, as it wouldn\u0027t depend to Jetty at all.\n\nFor the time being i have found the right solution that i am satisfied with (under current circumstances, of course) for the projects that depends on Jetty-9 and need SDM integration:\n\n* 1. Strip outdated jetty-8 from get-dev.jar\n* 2. Include Jetty 9.2 in the class path\n* 3. Replace WebServer.java in code server with Jetty-9 patched version from this change [1]. Note, only 5 lines of code were changed, compared to original version.\n* 4. Embed Codeserver invocation in own Daemon process to simplify SDM session experience, as it was done on this change [1].\n\nImprovement suggestions: to reduce the pain:\n\n* a. As suggested by Brian drop Jetty dependency from codeserver\n* b. Ship two version of codeserver with outdated and latest jetty-version, with 5 lines changed in WebServer.java, call ist gwt-codeserver-9.jar\n\n[1] https://gerrit-review.googlesource.com/59354",
      "parentUuid": "d3043104_5f7b8f3e",
      "range": {
        "startLine": 14,
        "startChar": 9,
        "endLine": 15,
        "endChar": 39
      },
      "revId": "22cddea8643021b4bc4a5c159ae40b498980716d",
      "serverId": "84fdd5b9-d3fc-3149-9ae9-e619898c4c46",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d3043104_3c26913f",
        "filename": "user/build.xml",
        "patchSetId": 13
      },
      "lineNbr": 84,
      "author": {
        "id": 5030
      },
      "writtenOn": "2014-08-18T11:24:01Z",
      "side": 1,
      "message": "If jetty-websocket needs to be in the classpath for tests, then it probably needs to be in the classpath for anyone running GWTTestCase with HtmlUnit, so it must be provided by gwt-dev.",
      "revId": "22cddea8643021b4bc4a5c159ae40b498980716d",
      "serverId": "84fdd5b9-d3fc-3149-9ae9-e619898c4c46",
      "unresolved": false
    }
  ]
}